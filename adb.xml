<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, January 02, 2023, 4:38 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "adb" generated by Plugin Wizard -->

<muclient>
<plugin
   name="adb"
   author="Athlau"
   id="cf78ba52f9bbad41f7e6b2e8"
   language="Lua"
   purpose="eq db of some sort"
   save_state="y"
   date_written="2023-01-02 16:37:58"
   requires="5.07"
   version="1.0"
   >
<description trim="y">
<![CDATA[
Bla bla bla, add more text here
]]>
</description>

</plugin>


<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   match="^{invmon}(?<action>\d+)\,(?<id>\d+)\,.+\,.+$"
   regexp="y"
   send_to="12"
   sequence="100"
   script="adbOnInvmonEvent"
   name="adbInvmonTrigger"
   omit_from_output="y"
  >
  </trigger>

  <trigger
   enabled="y"
   match="^{invitem}(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?)$"
   regexp="y"
   send_to="12"
   sequence="100"
   name="adbInvitemTrigger"
   omit_from_output="n"
   script="adbOnInvitemEvent"
  >
  </trigger>

  <trigger
   enabled="y"
   match="^You get (?:(?<gold>[0-9,]+) gold coins?|(?<item>.*)) from the \w+ corpse of (?<mob>.*)\.\n(?:(?i)\2(?-i) crumbles into (?<crumble>[0-9,]+) gold pieces?.|.*)\n\Z"
   regexp="y"
   send_to="12"
   sequence="100"
   keep_evaluating="y"
   lines_to_match="2"
   multi_line="y"
   script="adbOnItemLootedEvent"
  >
  </trigger> 
</triggers>

<aliases>
  <alias
   script="adbOnIdentifyCommand"
   match="^aid (?<id>\d+)$"
   regexp="y"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
require "tprint"
require "var"
require "serialize"
require "gmcphelper"
require "wait"
dofile(GetPluginInfo(GetPluginID(), 20).."adb_id.lua")

local adb_options = {}

function adbGetDefaultOptions()
  local default_options = {
    auto_id_received_items = true
  }
  return default_options
end

function adbCheckOptions()
end

function adbLoadOptions()
  adb_options = loadstring(string.format("return %s", var.config or serialize.save_simple(adbGetDefaultOptions())))()
  --TEMP
  adb_options = loadstring(string.format("return %s", serialize.save_simple(adbGetDefaultOptions())))()
  adbCheckOptions()
  adbSaveOptions()
end

function adbSaveOptions()
  var.config = serialize.save_simple(adb_options)
end

------ ID callback ------
function adbIdResultsReadyCB(obj)
  Note("got id results")
  tprint(obj)
end

------ Aliases/triggers callbacks------
function adbOnItemLootedEvent(name, line, wildcards, styles)
  Note("looted")
  tprint(wildcards)
  tprint(styles)
end

--inv.items.trigger.itemDataStats(objId, flags, itemName, level, typeField, unique, wearLoc, timer, isInvItem)
function adbOnInvitemEvent(name, line, wildcards, styles)
  Note("invitem "..line)
end

function adbOnInvmonEvent(name, line, wildcards)
  if wildcards.action == "4" or wildcards.action == "3" then
    Note("invmon "..line)
  end
end

function adbOnIdentifyCommand(name, line, wildcards)
  adbIdentifyItem(wildcards.id, adbIdResultsReadyCB)
end

function adbOnHelp()
  world.Note(world.GetPluginInfo(world.GetPluginID(), 3))
end

------ Plugin Callbacks ------

function tcOnHelp()
  world.Note(world.GetPluginInfo(world.GetPluginID(), 3))
end

function OnPluginInstall()
  adbOnHelp()
  OnPluginEnable()
end

function OnPluginEnable()
  adbLoadOptions()
end

function OnPluginConnect()
  adbLoadOptions()
end

function OnPluginDisable()
end

function OnPluginSaveState()
  adbSaveOptions()
end
]]>
</script>

</muclient>
